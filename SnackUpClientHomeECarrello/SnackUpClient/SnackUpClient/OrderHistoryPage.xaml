<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="SnackUpClient.OrderHistoryPage"
             xmlns:sf="clr-namespace:Syncfusion.Maui.TabView;assembly=Syncfusion.Maui.TabView"
             xmlns:core="clr-namespace:Syncfusion.Maui.Core;assembly=Syncfusion.Maui.Core"
             Title="OrderHistoryPage"
             BackgroundColor="#F7F7F7">
    <Grid>
        <!-- Overlay trasparente -->
        <BoxView x:Name="Overlay"
 BackgroundColor="Black"
 Opacity="0"
 IsVisible="False"
 ZIndex="2"
 InputTransparent="False">
            <BoxView.GestureRecognizers>
                <!-- Tocco per chiudere il menu -->
                <TapGestureRecognizer   Tapped="OnOverlayTapped" />
                <!-- Swipe verso sinistra per chiudere il menu -->
                <SwipeGestureRecognizer Direction="Left" Swiped="OnSwipeLeft" />
            </BoxView.GestureRecognizers>
        </BoxView>

        <!-- Menù laterale -->

        <StackLayout x:Name="MenuPanel"
     Opacity="1"
     WidthRequest="275"
     BackgroundColor="#F7F7F7"
     HorizontalOptions="Start"
     VerticalOptions="Fill"
     TranslationX="-265" 
     IsVisible="False"
     ZIndex="3">

            <Label Text="Menu" FontSize="24" FontFamily="Roboto-Bold" Padding="10,20,20,20" Margin="10,10,10,-20" />

            <Border BackgroundColor="White"
        Stroke="Transparent"
        StrokeShape="RoundRectangle 35"
        HeightRequest="1000"
        Padding="0,20,0,10"
        Margin="-1.1,20,30,0">
                <Border.Shadow>
                    <Shadow Brush="Black"
                Opacity="0.1"
                Radius="55"
                Offset="0,-10" />
                </Border.Shadow>

                <StackLayout>
                    <Label Text="SnackUp" FontFamily="Roboto-Black" TextColor="#FF7B21" FontSize="25" VerticalOptions="Center" HorizontalOptions="Start" Margin="15,10,10,10"/>
                    <Border HeightRequest="135"
                StrokeThickness="0"
                Padding="10,5,10,5"
                Margin="10"
                Stroke="Transparent"
                BackgroundColor="Transparent"
                StrokeShape="RoundRectangle 20"
                >
                        <Border.Background>
                            <LinearGradientBrush>
                                <GradientStop Color="#FF7B21" Offset="0.4" />
                                <GradientStop Color="#FDCE23" Offset="1.0" />
                            </LinearGradientBrush>
                        </Border.Background>
                        <Border.Shadow>
                            <Shadow Brush="Black" 
                    Opacity="0.2" 
                    Radius="30" 
                    Offset="0,0" />
                        </Border.Shadow>

                        <StackLayout Spacing="5" Margin="5" HorizontalOptions="FillAndExpand" VerticalOptions="FillAndExpand">
                            <!-- Primo Label -->
                            <StackLayout Orientation="Horizontal" HorizontalOptions="FillAndExpand">
                                <Label Text="Saldo del portafoglio"
                       FontSize="14"
                       TextColor="White"
                       FontFamily="Roboto-Medium"
                       VerticalOptions="Center"
                       HorizontalOptions="Start" />
                                <!-- Spacer -->
                                <BoxView HorizontalOptions="FillAndExpand" VerticalOptions="Center" BackgroundColor="Transparent" />
                                <Image Source="logo_tutorial_uno.png"
                       WidthRequest="25"
                       HeightRequest="25"
                       HorizontalOptions="End"
                       VerticalOptions="End" />
                            </StackLayout>

                            <!-- SALDO RIMANENTE -->
                            <Label x:Name="SaldoLabel"
                       FontSize="25"
                       FontFamily="Roboto-Black"
                       Margin="0,-4,0,0"
                       TextColor="White"
                       HorizontalOptions="Start" />

                            <!-- Bottone -->
                            <Button Text="Visualizza"
                        FontSize="14"
                        FontFamily="Roboto-Medium"
                        Margin="0,10,0,0"
                        BorderColor="White"
                        BorderWidth="1.2"
                        BackgroundColor="Transparent"
                        TextColor="White"
                        CornerRadius="20"
                        Padding="12,0,12,0"
                        HeightRequest="32"
                        Clicked="NavigateToWalletPage"                    
                        HorizontalOptions="Start" />
                        </StackLayout>
                    </Border>


                    <!-- Bottone Storico Ordini -->
                    <Frame Margin="-2, 8" Padding="0,0,0,0" BackgroundColor="Transparent" HasShadow="False" BorderColor="Transparent">
                        <StackLayout Orientation="Horizontal" Spacing="10">
                            <Frame Margin="-17,0,0,0" CornerRadius="15" BorderColor="Transparent" BackgroundColor="#FF7B21" HeightRequest="40"/>
                            <Image Source="storico_ordini_menu.svg" WidthRequest="20" HeightRequest="20" VerticalOptions="Center" />
                            <Label Text="Storico ordini" VerticalOptions="Center" />
                        </StackLayout>
                    </Frame>

                    <!-- Bottone Promozioni -->
                    <Frame Margin="-2, 8" Padding="0,0,0,0" BackgroundColor="Transparent" HasShadow="False" BorderColor="Transparent">
                        <StackLayout Orientation="Horizontal" Spacing="10">
                            <Frame x:Name="InnerFramePromo" Margin="-17,0,0,0" CornerRadius="15" BorderColor="Transparent" BackgroundColor="Transparent" HeightRequest="40"/>
                            <Image Source="promozioni_menu.svg" WidthRequest="20" HeightRequest="20" VerticalOptions="Center" />
                            <Label Text="Promozioni" VerticalOptions="Center" />
                        </StackLayout>
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Tapped="NavigateToPromoPage" />
                        </Frame.GestureRecognizers>
                    </Frame>

                    <!-- Bottone Abbonamento -->
                    <Frame Margin="-2, 8" Padding="0,0,0,0" BackgroundColor="Transparent" HasShadow="False" BorderColor="Transparent">
                        <StackLayout Orientation="Horizontal" Spacing="10">
                            <Frame x:Name="InnerFramePlus" Margin="-17,0,0,0" CornerRadius="15" BorderColor="Transparent" BackgroundColor="Transparent" HeightRequest="40"/>
                            <Image Source="abbonamento_menu.svg" WidthRequest="20" HeightRequest="20" VerticalOptions="Center" />
                            <Label Text="Abbonamento" VerticalOptions="Center" />
                        </StackLayout>
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Tapped="NavigateToPremiumPage" />
                        </Frame.GestureRecognizers>
                    </Frame>

                    <!-- Bottone Impostazioni -->
                    <Frame Margin="-2, 8" Padding="0,0,0,0" BackgroundColor="Transparent" HasShadow="False" BorderColor="Transparent">
                        <StackLayout Orientation="Horizontal" Spacing="10">
                            <Frame x:Name="InnerFrameSettings" Margin="-17,0,0,0" CornerRadius="15" BorderColor="Transparent" BackgroundColor="Transparent" HeightRequest="40"/>
                            <Image Source="impostazioni_menu.svg" WidthRequest="20" HeightRequest="20" VerticalOptions="Center" />
                            <Label Text="Impostazioni" VerticalOptions="Center" />
                        </StackLayout>
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Tapped="NavigateToSettingsPage" />
                        </Frame.GestureRecognizers>
                    </Frame>

                    <!-- Bottone Supporto e Assistenza -->
                    <Frame Margin="-2, 8" Padding="0,0,0,0" BackgroundColor="Transparent" HasShadow="False" BorderColor="Transparent">
                        <StackLayout Orientation="Horizontal" Spacing="10">
                            <Frame x:Name="InnerFrameSupport" Margin="-17,0,0,0" CornerRadius="15" BorderColor="Transparent" BackgroundColor="Transparent" HeightRequest="40"/>
                            <Image Source="supporto_menu.svg" WidthRequest="20" HeightRequest="20" VerticalOptions="Center" />
                            <Label Text="Supporto e Assistenza" VerticalOptions="Center" />
                        </StackLayout>
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Tapped="NavigateToSupportPage" />
                        </Frame.GestureRecognizers>
                    </Frame>


                    <Label Text="Versione 1.0 Beta" HorizontalTextAlignment="Center" Margin="0,110" TextColor="LightGray" FontSize="10" VerticalOptions="Center" />

                </StackLayout>
            </Border>

        </StackLayout>

        <Grid x:Name="MainContent" TranslationX="0" ZIndex="1">

            <!-- Contenitore per il contenuto principale e TabBar -->
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <!-- Contenuto principale -->
                    <RowDefinition Height="Auto" />
                    <!-- TabBar -->
                </Grid.RowDefinitions>

                <!-- Contenuto principale -->


                <Grid>
                    <!-- Schermata principale -->
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <!-- Icona Menù Hamburger -->
                    <ImageButton 
                 Source="hamburger_menu.svg"
                 WidthRequest="35" HeightRequest="35"
                 HorizontalOptions="Start"
                 VerticalOptions="Start"
                 Margin="30,30,20,10"
                 Clicked="OnMenuClicked"
                 Grid.Row="0" />

                    <Label Text="Storico ordini" Padding="0" Grid.Row="1" Margin="30,0,0,20" FontSize="30" FontFamily="Roboto-Black"></Label>

                    <sf:SfTabView Grid.Row="3" IndicatorWidthMode="Fit"
                                      IndicatorStrokeThickness="2" IndicatorCornerRadius ="50"  TabWidthMode="Default"
                                      IndicatorBackground="#FF7B21" Background="Transparent" HeaderDisplayMode="Default" >
                        <!-- Tab 1: Ordini in corso -->
                        <sf:SfTabItem Header="Ordini in corso"
                                          TextColor="#171717" FontSize="18" FontFamily="Roboto-Bold">
                            <CollectionView ItemsSource="{Binding OrdiniInCorso}" VerticalOptions="FillAndExpand" HorizontalOptions="FillAndExpand">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid BackgroundColor="Transparent" Padding="25,15,25,5">
                                            <Border BackgroundColor="White"
                                            Stroke="Transparent"
                                            StrokeShape="RoundRectangle 30"
                                            Padding="20,20,20,20"
                                            Margin="0,0,0,0">
                                                <Border.Shadow>
                                                    <Shadow Brush="Black" 
                                                Opacity="0.1" 
                                                Radius="20" 
                                                Offset="0,0" />
                                                </Border.Shadow>
                                                <Border.GestureRecognizers>
                                                    <TapGestureRecognizer Tapped="OnBorderTapped" />
                                                </Border.GestureRecognizers>

                                                <Grid ColumnDefinitions="*, Auto" RowDefinitions="Auto">
                                                    <!-- Parte sinistra: Dettagli ordine -->
                                                    <VerticalStackLayout Grid.Column="0" Grid.Row="0">
                                                        <!-- Giorno e orario -->
                                                        <Grid ColumnDefinitions="*,Auto" Background="Transparent">
                                                            <Label Text="{Binding Giorno}"
                                                                       Grid.Column="0"
                                                                       FontSize="19"
                                                                       FontFamily="Roboto-Bold"
                                                                       TextColor="#FF7B21"
                                                                       VerticalOptions="Start"/>

                                                            <!-- Prezzo totale -->
                                                            <Label Text="{Binding PrezzoTotale, StringFormat='{0:C}'}"
                                                                       FontSize="18"
                                                                       Grid.Column="1"
                                                                       FontFamily="Roboto-Bold"
                                                                       Margin="0,0,0,0"
                                                                       TextColor="#171717" VerticalOptions="End" HorizontalOptions="End" />
                                                        </Grid>
                                                        <Label Text="{Binding Orario}"
                                                                   FontSize="19"
                                                                   Margin="0,5,0,0"
                                                                   FontFamily="Roboto-Bold"
                                                                   TextColor="#171717" />
                                                        <!-- Elenco prodotti -->
                                                        <CollectionView ItemsSource="{Binding Prodotti}"
                                                                        Margin="0,10,0,10">
                                                            <CollectionView.ItemsLayout>
                                                                <LinearItemsLayout Orientation="Vertical" />
                                                            </CollectionView.ItemsLayout>
                                                            <CollectionView.ItemTemplate>
                                                                <DataTemplate>
                                                                    <HorizontalStackLayout>
                                                                        <Label Text="●"
                                                                               FontSize="14"
                                                                               TextColor="#FF7B21"
                                                                               VerticalOptions="Center"
                                                                               FontFamily="Roboto-Bold"/>
                                                                        <!-- Nome prodotto -->
                                                                        <Label Text="{Binding Nome}"
                                                                           FontSize="14"
                                                                           Margin="10,0,0,2"
                                                                           TextColor="#171717"
                                                                           FontFamily="Roboto"
                                                                           HorizontalOptions="End" />
                                                                        <!-- Quantità prodotto -->
                                                                        <Label Text="{Binding QuantitàFormattata}"
                                                                           FontSize="14"
                                                                           TextColor="#171717"
                                                                           FontFamily="Roboto"
                                                                           HorizontalOptions="Center" />

                                                                    </HorizontalStackLayout>
                                                                </DataTemplate>
                                                            </CollectionView.ItemTemplate>
                                                        </CollectionView>
                                                    </VerticalStackLayout>
                                                </Grid>
                                            </Border>
                                        </Grid>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>

                        </sf:SfTabItem>

                        <!-- Tab 2: Ordini già fatti -->
                        <sf:SfTabItem Header="Cronologia ordini"
                                          TextColor="#171717" FontSize="18" FontFamily="Roboto-Bold">
                            <CollectionView ItemsSource="{Binding StoricoOrdini}" VerticalOptions="FillAndExpand" HorizontalOptions="FillAndExpand">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid BackgroundColor="Transparent" Padding="20,15,20,5">
                                            <Border BackgroundColor="White"
                                                        Stroke="Transparent"
                                                        StrokeShape="RoundRectangle 30"
                                                        Padding="20,20,20,20"
                                                        Margin="0,0,0,0">
                                                <Border.Shadow>
                                                    <Shadow Brush="Black" 
                                                                Opacity="0.1" 
                                                                Radius="20" 
                                                                Offset="0,0" />
                                                </Border.Shadow>

                                                <Grid ColumnDefinitions="*, Auto" RowDefinitions="Auto">
                                                    <!-- Parte sinistra: Dettagli ordine -->
                                                    <VerticalStackLayout Grid.Column="0" Grid.Row="0">
                                                        <!-- Giorno e orario -->
                                                        <Grid ColumnDefinitions="*,Auto" Background="Transparent">
                                                            <Label Text="{Binding Giorno}"
                                                                       Grid.Column="0"
                                                                       FontSize="19"
                                                                       FontFamily="Roboto-Bold"
                                                                       TextColor="#FF7B21"
                                                                       VerticalOptions="Start"/>

                                                            <!-- Prezzo totale -->
                                                            <Label Text="{Binding PrezzoTotale, StringFormat='{0:C}'}"
                                                                       FontSize="18"
                                                                       Grid.Column="1"
                                                                       FontFamily="Roboto-Bold"
                                                                       Margin="0,0,0,0"
                                                                       TextColor="#171717" VerticalOptions="End" HorizontalOptions="End" />
                                                        </Grid>
                                                        <Label Text="{Binding Orario}"
                                                                   FontSize="19"
                                                                   Margin="0,5,0,0"
                                                                   FontFamily="Roboto-Bold"
                                                                   TextColor="#171717" />
                                                        <!-- Elenco prodotti -->
                                                        <CollectionView ItemsSource="{Binding Prodotti}"
                                                                            Margin="0,10,0,10">
                                                            <CollectionView.ItemsLayout>
                                                                <LinearItemsLayout Orientation="Vertical" />
                                                            </CollectionView.ItemsLayout>
                                                            <CollectionView.ItemTemplate>
                                                                <DataTemplate>
                                                                    <HorizontalStackLayout>
                                                                        <Label Text="●"
                                               FontSize="14"
                                               TextColor="#FF7B21"
                                               VerticalOptions="Center"
                                               FontFamily="Roboto-Bold"/>
                                                                        <!-- Nome prodotto -->
                                                                        <Label Text="{Binding Nome}"
                                           FontSize="14"
                                           Margin="10,0,0,2"
                                           TextColor="#171717"
                                           FontFamily="Roboto"
                                           HorizontalOptions="End" />
                                                                        <!-- Quantità prodotto -->
                                                                        <Label Text="{Binding QuantitàFormattata}"
                                           FontSize="14"
                                           TextColor="#171717"
                                           FontFamily="Roboto"
                                           HorizontalOptions="Center" />

                                                                    </HorizontalStackLayout>
                                                                </DataTemplate>
                                                            </CollectionView.ItemTemplate>
                                                        </CollectionView>
                                                    </VerticalStackLayout>
                                                </Grid>
                                            </Border>
                                        </Grid>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </sf:SfTabItem>
                    </sf:SfTabView>
                </Grid>
            </Grid>
        </Grid>
    </Grid>
</ContentPage>